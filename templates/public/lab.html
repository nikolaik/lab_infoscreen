<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>{{ lab.name|capfirst }}</title>
		<link rel="stylesheet"  type="text/css" href="/static/4sq_like.css" />
		<!--<meta http-equiv="refresh" content="15" />-->
		<script type="text/javascript" src="/static/jquery-1.4.4.js"></script>
		<script type="text/javascript" src="/static/jquery.jclock.js_4.js"></script>
		<script type="text/javascript" src="/static/jquery.timers-1.2.js"></script>

		<script type="text/javascript">
			/* Add a clock to the footer. */
    		$(function($) {
				var options = {
					format: '%A, %Y-%m-%d, %H:%M:%S'
				};
				$('.current_time').jclock(options);
		    });
			/* Function that updates the capacities */
			var update_capacities = function() {
					$( '#capacity' ).load(
						'/lab/{{ lab.name }}/capacity/');
						/*TODO: The url template keyword does not find the view, maybe the urlpattern is wrong.
						 * http://docs.djangoproject.com/en/dev/ref/templates/builtins/?from=olddocs*/
						/*'url lab_capacity');*/
					};
			/* Initial update */
			$( document ).ready( update_capacities );
			/* Ajax spinner */
			$( document ).ajaxStart( function() {
					$( '#spinner' ).show();
					}).ajaxStop( function() {
						$( '#spinner' ).hide();
					});
			/* Start timers updating screen resources. */
			$( document).everyTime('90s', update_capacities );
		  </script>
	</head>

	<body>
	<div id="container">
		<div id="header"><h1>{{ lab.name|capfirst }} lab</h1>
			{{ lab.welcome_msg }} 
		</div>
		<div id="left">
			<h2>Capacity</h2>
			<span id="spinner"><img src="/static/spinner.gif"/> Loading capacities...</span>
			<div id="capacity">	</div>
		</div>
		<div class="admins">
			<h2>Need help?</h2>
			Then just ask your lab assistant(s) 
			{% for admin in admins %}
				<div class="admin_name">{{ admin }}</div>
			{% endfor %}
			<!-- TODO: Sort according to custom machine order. -->
		</div>
			{% if printer_list %}
		<div id="right">
			<div class="printers">
				<table>
					<tr>
						<td>
							<img src="/static/printer.png" />
						</td>
						<td>
							<ul>
								{% for printer in printer_list %}
									<li>
										{{ printer.name }}: <span class="bold">{{ printer.queue_size|default:"No queue." }}</span>
										{% if printer.queue %}
										<ul>
											<li>{{ printer.queue }}</li>
										</ul>
										{% endif %}
									</li>
										
								{% endfor %}
							</ul>
						</td>
					</tr>
				</table>
			{% else %}
				<p>No printers defined.</p>
			{% endif %}
			</div>
			<div class="hours">
				<img src="/static/cairo-clock.png" />
				<span class="time">{{ hours.start|date:"H:i" }}</span> - <span class="time">{{ hours.end|date:"H:i" }}</span>
			</div>
		</div>
		<div id="footer">
			Lab assistants @ Mat-Nat
			<span class="current_time"></span>
		</div>
	</div>
	</body>
</html>
